var _=Object.defineProperty;var D=(t,s,e)=>s in t?_(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var i=(t,s,e)=>D(t,typeof s!="symbol"?s+"":s,e);import"./modulepreload-polyfill-B5Qt9EMX.js";function d(t){if(!t)throw new Error("Element not found!");return t}function l(t){const s=document.querySelector(t);return d(s)}function o(t){return document.querySelectorAll(t)}function c(t){return function(s){const e=t.querySelector(s);return d(e)}}function w(t,s){const e=new Uint32Array(1);window.crypto.getRandomValues(e);const n=e[0]/4294967296;return Math.floor(n*(s-t+1))+t}function h(t){return t.reduce((s,e)=>s+e,0)}const u=2,R=6,p=0,A=21;class E{constructor(){i(this,"containerEl",l(".debug-user"))}generateMarkup(){return`
			<div class="block">
				<div class="user__info">
					<h2 class="user__info-name">All Dice Rolls</h2>
					<span class="user__info-dash">&mdash;</span>
					<span class="user__info-result font-bold">0</span>
				</div>
				<div class="sub-block font-small main__all-rolls">Let's make a move</div>
			</div>
		`}update(){this.containerEl.insertAdjacentHTML("beforeend",this.generateMarkup())}}class P{constructor(){i(this,"containerEl",l(".users"))}generateMarkup(s){return`
			<div class="block user ${s===p&&"active"}">
				<div class="user__info">
					<h2 class="user__info-name">Player ${s+1}</h2>
					<span class="user__info-dash">&mdash;</span>
					<span class="user__info-result font-bold">0</span>
					<span class="user__info-in-turn font-semibold">In turn</span>
				</div>
				<div class="sub-block font-small user__results">0</div>
			</div>
		`}update({playerIndex:s}){this.containerEl.insertAdjacentHTML("beforeend",this.generateMarkup(s))}}class y{render({diceResults:s,targetEl:e,resultsClass:n,infoResultClass:r}){const b=c(e)(`.${n}`),m=c(e)(`.${r}`);b.innerHTML=s.join(", "),m.innerHTML=h(s).toString()}}class T extends y{update({diceResults:s}){const e=l(".debug-user");this.render({diceResults:s,targetEl:e,resultsClass:"main__all-rolls",infoResultClass:"user__info-result"})}}class v extends y{update({playerIndex:s,diceResults:e}){const n=o(".user")[s];this.render({diceResults:e,targetEl:n,resultsClass:"user__results",infoResultClass:"user__info-result"})}}class S{update({playerIndex:s,isWin:e}){if(e){const n=o(".user")[s];n.classList.contains("winner")||n.classList.add("winner")}}}class x{update({inTurnIndex:s}){const e=o(".user"),n=e[s];e.forEach(r=>r.classList.remove("active")),n.classList.add("active")}}class I{constructor(){i(this,"turnGenerator",new L(u));i(this,"diceGenerator",new g(R));i(this,"initialAdminDisplayer",new E);i(this,"resultsAdminDisplayer",new T);i(this,"initialPlayerDisplayer",new P);i(this,"resultsPlayerDisplayer",new v);i(this,"winStatusDisplayer",new S);i(this,"inTurnDisplayer",new x);this.turnGenerator.subscribe(this.diceGenerator),this.createAdmin(),this.createPlayers()}createAdmin(){const s={displayerInstances:{initialAdminDisplayer:this.initialAdminDisplayer,resultsAdminDisplayer:this.resultsAdminDisplayer}},e=new k(s);this.diceGenerator.subscribe(e)}createPlayers(){Array.from({length:u}).map((s,e)=>{const n={selfIndex:e,displayerInstances:{initialPlayerDisplayer:this.initialPlayerDisplayer,resultsPlayerDisplayer:this.resultsPlayerDisplayer,winStatusDisplayer:this.winStatusDisplayer,inTurnDisplayer:this.inTurnDisplayer}},r=new M(n);this.diceGenerator.subscribe(r)})}run(){this.turnGenerator.next()}}class a{constructor(){i(this,"subscribers",new Set)}subscribe(s){this.subscribers.add(s)}unsubscribe(s){this.subscribers.delete(s)}notify(s){this.subscribers.forEach(e=>e.update(s))}}class L extends a{constructor(s,e=p){super(),this.playersCount=s,this.currentPlayerIndex=e}next(){this.notify(this.currentPlayerIndex),this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playersCount}}class g extends a{constructor(s){super(),this.sidesCount=s}roll(){return w(1,this.sidesCount)}update(s){this.notify({playerIndex:s,diceResult:this.roll()})}}class f{constructor(){i(this,"diceResults",[]);i(this,"results",new a)}}class k extends f{constructor({displayerInstances:e}){super();i(this,"initial",new a);this.initial.subscribe(e.initialAdminDisplayer),this.results.subscribe(e.resultsAdminDisplayer),this.initial.notify(null)}update({playerIndex:e,diceResult:n}){this.diceResults.push(n),this.results.notify({playerIndex:e,diceResults:this.diceResults})}}class M extends f{constructor({selfIndex:e,winnerDiceTotalResult:n,displayerInstances:r}){super();i(this,"selfIndex");i(this,"winnerDiceTotalResult",A);i(this,"initial",new a);i(this,"winStatus",new a);i(this,"inTurn",new a);this.selfIndex=e,n!==void 0&&(this.winnerDiceTotalResult=n),this.initial.subscribe(r.initialPlayerDisplayer),this.results.subscribe(r.resultsPlayerDisplayer),this.winStatus.subscribe(r.winStatusDisplayer),this.inTurn.subscribe(r.inTurnDisplayer),this.initial.notify({playerIndex:this.selfIndex})}update({playerIndex:e,diceResult:n}){e===this.selfIndex&&(this.diceResults.push(n),this.results.notify({playerIndex:e,diceResults:this.diceResults}),this.winStatus.notify({playerIndex:e,isWin:h(this.diceResults)>=this.winnerDiceTotalResult}),this.inTurn.notify({inTurnIndex:(e+1)%u}))}}window.onload=function(){const t=new I,s=l(".make-a-move");s&&(s.onclick=function(){t.run()})};
